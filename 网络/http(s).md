# http与https
http与https都属于应用层协议，他们的协议栈共涉及4-5层，核心差异https多了SSL/TLS层，用于加密传输。
## TCP/IP 模型的核心层级
- 物理层：负责物理介质的数据传输，如网线、无线
- 数据链路层：处理物理地址，如MAC地址，实现局域网内数据传输
- 网络层：通过IP 地址实现跨网络路由（如 IP 协议）
- 传输层：提供端到端的可靠/不可靠传输服务（如 TCP可靠传输、UDP不可靠传输）
- 应用层：直接面相用户应用（如 HTTP、HTTPS、FTP、DNS等）

## TCP三次握手
TCP三次握手是TCP协议建立连接的过程，确保双方都准备好进行数据传输。

客户端发送SYN包，传输seq为x，请求建立连接
服务端收到SYN包，回复SYN-ACK包，传输seq为y，ack为x+1，确认连接请求
客户端收到SYN-ACK包，回复ACK包，ack为y+1，确认连接建立

## 什么时候会建立新的tcp连接
- 首次访问或者连接已断开时
   - 用户第一次打开某网站，或之前与服务器的tcp连接已断开
- HTTP/1.1及以下版本的并发请求
   - 这类版本对同一域名的并发TCP 连接数有限制（浏览器通常限制2-6个），当页面请求的资源数量超过限制数量，超出部分会等待已有连接释放或直接建立新的TCP连接
- 跨域名请求资源
  - 如A网站请求B网站的资源，会建立新的TCP连接

举例：
点击链接进入某电商网站，浏览器会先加载页面的核心 HTML问价，此时是首次访问电商域名，之前无任何连接，所以先建立一个TCP连接，用来传输HTML文件。
接着浏览器解析HTML文件发现还需要加载10张图，2个css，3个js文件，这些资源都属于电商自己的同一个域名。浏览器对同一个域名并发TCP默认限制为6个，所以
- 先用刚才传输HTML的TCP连接，再新建5个TCP连接，凑够6个并发连接
- 用这6个连接同时请求资源
- 等其中一个加载完资源并释放，再用这个空闲的 请求第七个资源，无需新建。如果所有连接都在忙，超出资源则继续等待，等有空闲连接时再请求。

如果页面解析需要加载一个第三方的广告（来自广告商的域名）和一个支付安全验证脚本（来自支付服务商的域名），会分别建立新的TCP连接。


## SSL/TLS 握手
SSL/TLS 握手是 HTTPS 协议的基础，用于在客户端和服务器之间建立加密连接。
- 客户端发送 ClientHello 包，包含支持的加密算法、压缩方法等信息
- 服务器收到 ClientHello 包，回复 ServerHello 包，包含选择的加密算法、压缩方法等信息
- 服务器发送证书链（包含服务器公钥）给客户端
- 客户端验证证书链的有效性（如是否由可信的证书颁发机构签名）
- 客户端发送 PreMasterSecret 给服务器，用于后续加密通信
- 服务器用自己的私钥解密 PreMasterSecret，得到对称加密密钥
- 客户端和服务器用对称加密密钥加密通信，实现安全传输