在 Web 页面渲染过程中，重排（Reflow） 和 重绘（Repaint） 是浏览器更新页面视觉呈现的两个核心操作，二者直接影响页面性能，尤其是频繁触发时可能导致卡顿。

# 重排（Reflow）
含义：当 DOM 元素的布局信息发生变化（如尺寸、位置、结构、内容量）时，浏览器需要重新计算页面中所有元素的几何位置和尺寸，构建新的布局树（Layout Tree）的过程。

本质：改变元素的 “布局属性”，触发浏览器的布局计算，是更消耗性能的操作。

常见触发场景：
- 改变元素的盒模型属性（width、height、margin、padding、border）；
- 改变元素的定位方式（position、top、left、float）；
- 增减 DOM 元素（如appendChild、removeChild）或修改 DOM 结构；
- 改变页面根元素尺寸（如窗口resize、滚动页面）；
- 修改元素内容（如大量文本更新、图片加载完成后尺寸变化）；
- 读取或修改影响布局的 CSS 属性（如offsetWidth、scrollTop）。

# 重绘（Repaint）
含义：当 DOM 元素的视觉样式发生变化，但不影响布局时，浏览器仅重新绘制元素的像素内容，无需重新计算布局的过程。

本质：改变元素的 “外观属性”，不涉及布局调整，性能消耗比重排低。

常见触发场景：
- 改变元素的颜色相关属性（color、background-color、border-color）；
- 改变元素的视觉效果（box-shadow、text-shadow、opacity）；
- 改变元素的背景图片（background-image）；
- 隐藏 / 显示元素（visibility: hidden 仅触发重绘，display: none 触发重排 + 重绘）。

# 二者的关联与区别
重排必然触发重绘：布局改变后，元素的视觉呈现一定变化，浏览器需重新绘制受影响的区域。

重绘不一定触发重排：仅改变外观不影响布局时，无需重新计算布局，直接重绘即可。

# 性能影响与优化策略
## 性能影响
频繁的重排和重绘会导致浏览器主线程阻塞，出现页面卡顿、加载缓慢等问题（尤其是移动端或低端设备）。例如：在循环中频繁修改元素的width和color，会触发多次重排 + 重绘，严重影响性能。

## 优化策略
### 减少重排 / 重绘次数
批量操作 DOM：
- 避免在循环中直接操作 DOM，先创建文档片段（DocumentFragment），批量添加元素后再插入页面；
- 批量修改样式时，优先使用class切换（一次性应用多个样式），而非逐个修改style属性。

离线操作 DOM：
- 将元素从 DOM 树中移除（如display: none），修改完成后再重新插入，减少在可视 DOM 中的操作。
### 避免触发不必要的重排
慎用布局相关属性：
- 避免在循环中直接操作影响布局的属性（如width、height、margin、padding、position等），而是先缓存计算结果，最后一次性应用。
- 避免频繁读取会触发布局计算的属性（如offsetWidth、scrollTop等），而是先缓存计算结果，最后一次性应用。

使用脱离文档流的布局：
- 对频繁变化的元素，使用position: absolute或fixed使其脱离正常文档流，此时其布局变化不会影响其他元素，减少重排范围。

优化动画性能：
- 优先使用transform和opacity实现动画（浏览器可通过 GPU 加速，避免触发重排，仅触发重绘或不触发重绘）；
- 避免对width、top、margin等属性做动画，因为这些属性会触发重排。

# 检测工具
通过 Chrome DevTools 可定位重排 / 重绘问题：
- 打开 DevTools（F12），点右上角...，切换到 More Tools > Rendering面板；
- 勾选Paint flashing（重绘区域高亮）和Layout shifts（布局偏移高亮）；
- 操作页面时，高亮区域即为重绘 / 重排的区域，可针对性优化。

